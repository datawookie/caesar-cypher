<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caesar Cypher</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîê</text></svg>">
</head>
<body>
    <div class="container">
        <h1>üîê Caesar Cypher</h1>
        
        <div class="input-group">
            <label for="plaintext">Plain Text:</label>
            <div class="text-input-wrapper">
                <textarea 
                    id="plaintext" 
                    placeholder="Enter plain text here."
                    autocomplete="off"
                    spellcheck="false"
                ></textarea>
                <button class="copy-button" id="copy-plain" title="Copy plain text">üìã Copy</button>
            </div>
            <div class="char-count" id="plain-count">0 characters</div>
        </div>
        
        <div class="offset-group">
            <label for="offset">Cypher Offset:</label>
            <select id="offset">
                <option value="1">1 ‚Äî Simple shift</option>
                <option value="2">2</option>
                <option value="3" selected>3 ‚Äî Classic</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12 ‚Äî Half shift</option>
                <option value="13">13 ‚Äî ROT13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25 ‚Äî Atbash</option>
            </select>
        </div>
        
        <div class="input-group">
            <table class="mapping-table" id="mapping-table">
                <tbody>
                    <tr class="original-row">
                        <td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td><td>J</td><td>K</td><td>L</td><td>M</td>
                        <td>N</td><td>O</td><td>P</td><td>Q</td><td>R</td><td>S</td><td>T</td><td>U</td><td>V</td><td>W</td><td>X</td><td>Y</td><td>Z</td>
                    </tr>
                    <tr class="shifted-row" id="shifted-row">
                        <td id="shift-A">D</td><td id="shift-B">E</td><td id="shift-C">F</td><td id="shift-D">G</td><td id="shift-E">H</td><td id="shift-F">I</td>
                        <td id="shift-G">J</td><td id="shift-H">K</td><td id="shift-I">L</td><td id="shift-J">M</td><td id="shift-K">N</td><td id="shift-L">O</td>
                        <td id="shift-M">P</td><td id="shift-N">Q</td><td id="shift-O">R</td><td id="shift-P">S</td><td id="shift-Q">T</td><td id="shift-R">U</td>
                        <td id="shift-S">V</td><td id="shift-T">W</td><td id="shift-U">X</td><td id="shift-V">Y</td><td id="shift-W">Z</td><td id="shift-X">A</td>
                        <td id="shift-Y">B</td><td id="shift-Z">C</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="input-group">
            <label for="cyphertext">Cypher Text:</label>
            <div class="text-input-wrapper">
                <textarea 
                    id="cyphertext" 
                    placeholder="Enter encrypted text here."
                    autocomplete="off"
                    spellcheck="false"
                ></textarea>
                <button class="copy-button" id="copy-cipher" title="Copy cipher text">üìã Copy</button>
            </div>
            <div class="char-count" id="cypher-count">0 characters</div>
        </div>
        
        <div class="info">
            <strong>How it works:</strong> The Caesar cypher shifts each letter in the alphabet by a fixed number of positions. 
            Numbers, spaces, and special characters remain unchanged. The classic Caesar cypher uses an offset of 3.
            <br><br>
            <strong>Bidirectional:</strong> You can type in either the Plain
            Text or Cypher Text box. The other box will update automatically!
        </div>
    </div>

    <script>
        class CaesarCypher {
            constructor() {
                this.plaintextEl = document.getElementById('plaintext');
                this.cyphertextEl = document.getElementById('cyphertext');
                this.offsetEl = document.getElementById('offset');
                this.plainCountEl = document.getElementById('plain-count');
                this.cypherCountEl = document.getElementById('cypher-count');
                this.copyPlainBtn = document.getElementById('copy-plain');
                this.copyCipherBtn = document.getElementById('copy-cipher');
                this.updating = false; // Flag to prevent infinite loops
                this.lastFocusedField = 'plaintext'; // Track which field was last focused
                
                this.initializeEventListeners();
                this.updateMappingTable(); // Initial table update
                this.updateCypherText(); // Initial update
            }
            
            initializeEventListeners() {
                // Update cypher text when plain text changes
                this.plaintextEl.addEventListener('input', () => {
                    if (!this.updating) {
                        this.updateCypherText();
                    }
                });
                
                // Update plain text when cypher text changes
                this.cyphertextEl.addEventListener('input', () => {
                    if (!this.updating) {
                        this.updatePlainText();
                    }
                });
                
                // Track which field is focused
                this.plaintextEl.addEventListener('focus', () => {
                    this.lastFocusedField = 'plaintext';
                });
                
                this.cyphertextEl.addEventListener('focus', () => {
                    this.lastFocusedField = 'cyphertext';
                });
                
                // Update based on which field is focused when offset changes
                this.offsetEl.addEventListener('change', () => {
                    if (!this.updating) {
                        this.updateMappingTable(); // Update the mapping table
                        
                        // Update based on which field is currently focused/selected
                        if (this.lastFocusedField === 'cyphertext') {
                            // If cyphertext field was last focused, update plaintext
                            this.updatePlainText();
                        } else {
                            // Default to updating cyphertext (plaintext focused or no focus)
                            this.updateCypherText();
                        }
                    }
                });
                
                // Copy button event listeners
                this.copyPlainBtn.addEventListener('click', () => {
                    this.copyToClipboard(this.plaintextEl.value, this.copyPlainBtn);
                });
                
                this.copyCipherBtn.addEventListener('click', () => {
                    this.copyToClipboard(this.cyphertextEl.value, this.copyCipherBtn);
                });
                
                // Initial character count
                this.updateCharCount();
            }
            
            caesarShift(text, shift) {
                return text.split('').map(char => {
                    // Check if character is a letter
                    if (/[a-zA-Z]/.test(char)) {
                        const isUpperCase = char === char.toUpperCase();
                        const charCode = char.toLowerCase().charCodeAt(0);
                        const alphabetPosition = charCode - 97; // 'a' is 97
                        
                        // Apply shift with wrap-around (handle negative shifts properly)
                        const shiftedPosition = ((alphabetPosition + shift) % 26 + 26) % 26;
                        const newCharCode = shiftedPosition + 97;
                        const newChar = String.fromCharCode(newCharCode);
                        
                        return isUpperCase ? newChar.toUpperCase() : newChar;
                    }
                    
                    // Return non-letter characters unchanged
                    return char;
                }).join('');
            }
            
            updateCypherText() {
                this.updating = true;
                const plaintext = this.plaintextEl.value;
                const offset = parseInt(this.offsetEl.value);
                
                const cyphertext = this.caesarShift(plaintext, offset);
                this.cyphertextEl.value = cyphertext;
                
                this.updateCharCount();
                this.updating = false;
            }
            
            updatePlainText() {
                this.updating = true;
                const cyphertext = this.cyphertextEl.value;
                const offset = parseInt(this.offsetEl.value);
                
                // To decrypt, we shift in the opposite direction
                const plaintext = this.caesarShift(cyphertext, -offset);
                this.plaintextEl.value = plaintext;
                
                this.updateCharCount();
                this.updating = false;
            }
            
            updateMappingTable() {
                const offset = parseInt(this.offsetEl.value);
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                
                // Update each letter in the shifted row
                for (let i = 0; i < 26; i++) {
                    const originalLetter = alphabet[i];
                    const shiftedIndex = (i + offset) % 26;
                    const shiftedLetter = alphabet[shiftedIndex];
                    
                    const cellId = `shift-${originalLetter}`;
                    const cell = document.getElementById(cellId);
                    if (cell) {
                        cell.textContent = shiftedLetter;
                    }
                }
            }
            
            updateCharCount() {
                const plainCount = this.plaintextEl.value.length;
                const cypherCount = this.cyphertextEl.value.length;
                
                this.plainCountEl.textContent = `${plainCount} character${plainCount !== 1 ? 's' : ''}`;
                this.cypherCountEl.textContent = `${cypherCount} character${cypherCount !== 1 ? 's' : ''}`;
            }
            
            copyToClipboard(text, button) {
                if (!text) {
                    return; // Don't copy empty text
                }
                
                navigator.clipboard.writeText(text).then(() => {
                    // Success feedback
                    const originalText = button.textContent;
                    button.textContent = '‚úì Copied!';
                    button.classList.add('success');
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.classList.remove('success');
                    }, 1500);
                }).catch(err => {
                    // Fallback for older browsers
                    console.error('Failed to copy text: ', err);
                    button.textContent = '‚ùå Failed';
                    setTimeout(() => {
                        button.textContent = 'üìã Copy';
                    }, 1500);
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new CaesarCypher();
        });
    </script>
</body>
</html>